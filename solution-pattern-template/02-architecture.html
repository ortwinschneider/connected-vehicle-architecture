<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Red Hat Connected Vehicle Architecture :: Solution Patterns from Red Hat</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/solution-pattern-template/02-architecture.html">
    <link rel="prev" href="01-pattern.html">
    <link rel="next" href="03-demo.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LDT1TRNR8R"></script>
<script>function gtag() { dataLayer.push(arguments) }; window.dataLayer = window.dataLayer || []; gtag('js', new Date()); gtag('config', 'G-LDT1TRNR8R')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns from Red Hat</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="solution-pattern-template" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="01-pattern.html" class=" query-params-link">Connected Vehicle Architecture</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-pattern.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#overview">1.1 Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-pattern.html#story-behind">1.2 The story behind this solution pattern</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-pattern.html#sdv">1.3 Software Defined Vehicles</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-pattern.html#cloud-native-approach">1.4 In-Vehicle cloud-native approach</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-pattern.html#containers-on-wheels">1.5 Containers on Wheels</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#use-cases">1.6 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#redhat-help">1.7 How Red Hat can help?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-pattern.html#more-pattern">1.8 Explore more solution patterns</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#core_concepts">2.1. Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#drogue_stack">2.2. Drogue Connectivity Stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#cloud_processing">2.3. Cloud side processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.4. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#in_depth">2.5. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tech_stack">2.6. More about the technology stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. See the Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#demo-video">3.1. Demo Recording</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html#installation">3.2. Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#install-prereq">3.3. Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#install-run">3.4. Installing the demo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#install-cleanup">3.5. Cleaning up</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/" target="_blank" rel="noopener">4. Other Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Connected Vehicle Architecture</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Connected Vehicle Architecture</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="01-pattern.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="01-pattern.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="01-pattern.html">Connected Vehicle Architecture</a></li>
    <li><a href="02-architecture.html">2. Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-solution-patterns/solution-pattern-connected-vehicle-architecture/edit/main/documentation/modules/ROOT/pages/02-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Red Hat Connected Vehicle Architecture</h1>
<h1 id="_architecture" class="sect0"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">Architecture</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="_images/architecture.png" alt="architecture" width="100%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="core_concepts"><a class="anchor" href="#core_concepts"></a><a class="link" href="#core_concepts">1. Core Concepts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a technical perspective, the solution pattern has two core elements: <strong>Connected Vehicles</strong> and <strong>Connected Vehicles Zones</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Connected Vehicles:</strong></p>
</div>
<div class="paragraph">
<p>The vehicle simulators are implemented in Quarkus (cloud-native Java stack) that simulate vehicles (connected cars) and send telemetry data to a regional IoT cloud backend. In this demo they represent the vehicle edge.</p>
</div>
<div class="paragraph">
<p><strong>Connected Vehicles Zone:</strong></p>
</div>
<div class="paragraph">
<p>A Connected Vehicles Zone represents a configuration for a specific location, e.g. an environmental zone for which a maximum CO2 emission has been defined. Or a listing of various mobility services that are available at this location. The Connected Vehicles zones are implemented as a Kubernetes Custom Resource.</p>
</div>
<div class="paragraph">
<p>For each simulated vehicle, a route is initially randomly selected from a pool of routes. Driving this route from start to destination is simulated and the current position data as well as current telemetry data such as speed, RPM, CO2 emissions&#8230;&#8203; are sent over the Drogue.io connectivity stack to a regional IoT cloud backend infrastructure. This is done by streaming all sensor data from the vehicles to local Kafka clusters.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="drogue_stack"><a class="anchor" href="#drogue_stack"></a><a class="link" href="#drogue_stack">2. Drogue.io connectivity stack</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://drogue.io" target="_blank" rel="noopener">Drogue IoT</a> cloud components provide a connectivity layer between the edge and the cloud. Devices, cars in the case, are being registered with the device registry, storing credentials and configuration. Devices can also act as a gateway towards the cloud. Multiple local sub-devices can access the cloud through that gateway device. These don’t need to be physical devices, but could also be different applications/containers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/drogue-cloud.svg" alt="drogue cloud" width="80%">
</div>
</div>
<div class="paragraph">
<p>Data can come in through either MQTT (v3, v5), CoAP, HTTP, or a custom provided protocol adapter. The actual payload is not processed, but passed along as a CloudEvent to the consuming application, which can again consume it via Kafka, MQTT, WebSocket, or Serverless APIs. In the middle the incoming telemetry is buffered in Kafka, so that consuming applications can be scaled and process a backlog when necessary.</p>
</div>
<div class="paragraph">
<p>Commands (cloud-to-device messages) flow back the same path.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/drogue-data-plane.svg" alt="drogue data plane" width="80%">
</div>
</div>
<div class="paragraph">
<p>Part of the telemetry data are connectivity events, which allow to deduct if a device is currently connected to the system. This allows the consuming applications to trigger actions, like sending commands or initiating things like updates.</p>
</div>
<div class="paragraph">
<p>The device registry is designed in a way that it can integrate with external device management systems. For example, it is possible to reconcile the device configuration with an external management system. This can be achieved by creating a custom, operator-style process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cloud_processing"><a class="anchor" href="#cloud_processing"></a><a class="link" href="#cloud_processing">3. Cloud side processing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Kafka is the central system for all incoming data. The incoming data is made available via web socket to a real-time dashboard for visualization and is also updated in a distributed in-memory cache. This means that the last status of the entire IoT system can be retrieved from the cache at any time.</p>
</div>
<div class="paragraph">
<p>The cloud-native integration framework Apache Camel-K was used to integrate the systems involved. Specifically, the integration of MQTT into Kafka, the integration of Kafka into the cache as well as the websocket endpoints and the cache REST API have been implemented.</p>
</div>
<div class="paragraph">
<p>When vehicles enter or leave a Bobbycar Zone, a Zone Change Event is triggered. This event is made available to the respective vehicle as an MQTT message and is also used in the form of a cloud event to trigger an over-the-air update by calling serverless services/functions.</p>
</div>
<div class="paragraph">
<p>The updated zone configuration is not pushed into the vehicles, but rather the vehicles obtain the current configuration via the cache API after a zone change event.</p>
</div>
<div class="paragraph">
<p>By using Kafka Mirror Maker, the incoming data from the regional Kafka clusters is transferred to the Kafka clusters in the central IoT cloud in order to persist an aggregated status across all locations and, for example, to carry out stream analytics on this basis.
Furthermore, the relevant data from the regional Kafka clusters is stored in an S3 compatible data lake in the central IoT cloud, and is then used for machine learning with, for example, Red Hat OpenShift AI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="in_depth"><a class="anchor" href="#in_depth"></a><a class="link" href="#in_depth">4. An in-depth look at the solution&#8217;s architecture</a></h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/ocp-topology.png" alt="ocp topology" width="100%">
</div>
</div>
<div class="sect2">
<h3 id="_car_simulator_component"><a class="anchor" href="#_car_simulator_component"></a><a class="link" href="#_car_simulator_component">4.1. car-simulator component</a></h3>

</div>
<div class="sect2">
<h3 id="_dashboard_component"><a class="anchor" href="#_dashboard_component"></a><a class="link" href="#_dashboard_component">4.2. dashboard component</a></h3>

</div>
<div class="sect2">
<h3 id="_ota_server_component"><a class="anchor" href="#_ota_server_component"></a><a class="link" href="#_ota_server_component">4.3. ota-server component</a></h3>

</div>
<div class="sect2">
<h3 id="_kafka2datagrid_component"><a class="anchor" href="#_kafka2datagrid_component"></a><a class="link" href="#_kafka2datagrid_component">4.4. kafka2datagrid component</a></h3>

</div>
<div class="sect2">
<h3 id="_apache_kafka"><a class="anchor" href="#_apache_kafka"></a><a class="link" href="#_apache_kafka">4.5. Apache Kafka</a></h3>

</div>
<div class="sect2">
<h3 id="_mqtt_broker"><a class="anchor" href="#_mqtt_broker"></a><a class="link" href="#_mqtt_broker">4.6. MQTT Broker</a></h3>

</div>
<div class="sect2">
<h3 id="_apache_camel_k"><a class="anchor" href="#_apache_camel_k"></a><a class="link" href="#_apache_camel_k">4.7. Apache Camel-K</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="tech_stack"><a class="anchor" href="#tech_stack"></a><a class="link" href="#tech_stack">5. Technology Stack</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.redhat.com/en/technologies/cloud-computing/openshift">Red Hat OpenShift</a></p>
<div class="ulist">
<ul>
<li>
<p>OpenShift Serverless</p>
</li>
<li>
<p>OpenShift Pipelines</p>
</li>
</ul>
</div>
</li>
<li>
<p>Red Hat Application Foundation</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/products/quarkus">Quarkus</a></p>
</li>
<li>
<p>AMQ Streams</p>
</li>
<li>
<p>AMQ Broker</p>
</li>
<li>
<p>Apache Camel-K</p>
</li>
<li>
<p>Datagrid</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://helm.sh/">Helm</a></p>
</li>
<li>
<p>Angular</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-pattern.html" class="query-params-link">1. Home page</a></span>
  <span class="next"><a href="03-demo.html" class="query-params-link">3. See the Solution in Action</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
